# -----------------------------------------------------------------------
#
#  Tokiwa Software GmbH, Germany
#
#  Source code of Fuzion webserver feature split_query
#
# -----------------------------------------------------------------------
#
# decode the url in the query string and add it to the query_pairs map
#
module split_query(query String) lock_free.map String String =>
  query_pairs := (lock_free.map String String).empty
  pairs := query.split "&"
  for pair in pairs do
    idx := pair.find "="
    if idx.exists
      k := Java.java.net.URLDecoder_static.decode (pair.substring 0 idx.get ) "UTF-8"
      v := Java.java.net.URLDecoder_static.decode (pair.substring idx.get+1) "UTF-8"
      if !k.is_error && !v.is_error
        query_pairs.add (id String k.get) (id String v.get)
      else
        panic "decode error !!! "
    else
      panic "pleasy check query!!!! missing = character"

  query_pairs
