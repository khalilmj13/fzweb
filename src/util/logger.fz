# -----------------------------------------------------------------------
#
#  Tokiwa Software GmbH, Germany
#
#  Source code of Fuzion webserver feature logger
#
# -----------------------------------------------------------------------

module logger is
  # Atomic integer to maintain a unique thread ID
  thread_id_count := Java.java.util.concurrent.atomic.AtomicInteger.new

  # Thread local storage for thread IDs
  thread_id := thread_id_count.getAndIncrement

  module log(s2 String) =>
    say "{logger.thread_id}: {s2}"

  module log (logpath String,msg String) =>
    some_type is
    x := io.file.use some_type (String) logpath.as_string io.file.mode.write ()->
      _ := (io.file.open some_type).read
      m := logger.thread_id.as_string+": "+msg
      _ := (io.file.open some_type).write m.utf8
      _ := (io.file.open some_type).write "\r\n".utf8
      say m
    match x
      e error => panic "*** failed to write to log : {e}"
      f String => say f

