# -----------------------------------------------------------------------
#
#  Tokiwa Software GmbH, Germany
#
#  Source code of Fuzion webserver feature session
#
# -----------------------------------------------------------------------

# session -- facilities providing the session management for the Fuzion
# webserver
#
module session is

  module attribute_map(entry String) lock_free.map String String =>
    map := url_encoded.parse_urlencoded_map entry
    res := (lock_free.map String String).empty
    for pair in map.items do
      if (pair.1.starts_with "\"") && (pairs.1.ends_with "\"")
        v := pair.1.substring 1 pairs.1.byte_length
        res.add pair.0 v
      else
        res.add pair.0 pair.1
    res

  module get_tag(s String, tag String) option(lock_free.map String String) =>

    match s.find tag
      c i32 =>
        match s.find "/>" c+tag.byte_length
          ce i32 =>
            entry := s.substring c+tag.byte_length ce
            attribute_map entry
          nil => nil
      nil => nil

  # NYI
  module read_all_lines(path String, return_null_on_error bool,pretty_print bool) String =>
    ""

  module strip_html(page String) String =>
    if page.ends_with ".html" || page.ends_with ".htm"
      page.substring 0 (page.find ".")
    else if page = ""
      "index"
    else
      page

  module add_html(page String) String =>
    if !jflang.Content_static.isKnownPreformattedFile page
      page + ".html"
    else
      page

  module has_embedded_html(html String) bool =>
    !(html.find "<!DOCTYPE html>").is_nil && !(html.find "</html>").is_nil

